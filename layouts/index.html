{{- define "main" }}
<div class="home-split">
  <!-- Left: Profile Card -->
  <aside>
    <div class="profile-card">
      {{- with site.Params.homeInfoParams }}
      <img src="/lyy.jpg" alt="Avatar" class="profile-avatar">
      <h1 class="profile-name">{{ .Title }}</h1>
      <p class="profile-bio">{{ .Content | markdownify }}</p>
      {{- end }}

      <!-- Hitokoto ä¸€è¨€ -->
      <div class="hitokoto-widget">
        <p class="hitokoto-text" id="hitokoto">Loading...</p>
        <p class="hitokoto-from" id="hitokoto-from"></p>
      </div>

      <footer class="profile-footer">
        {{ partial "social_icons.html" (dict "align" site.Params.homeInfoParams.AlignSocialIconsTo) }}
        {{- if hugo.IsProduction }}
        <!-- Visitor Counter ä¸è’œå­ (production only) -->
        <div class="visitor-counter">
          <span>ğŸ‘€ <span id="busuanzi_value_site_pv">--</span> views</span>
        </div>
        {{- end }}
      </footer>
    </div>
  </aside>

  <!-- Right: Timeline -->
  <section>
    {{- $pages := where site.RegularPages "Type" "in" site.Params.mainSections }}
    {{- $pages = where $pages "Params.hiddenInHomeList" "!=" "true" }}
    {{- $paginator := .Paginate $pages }}

    <div class="timeline">
      {{- range $paginator.Pages }}
      <article class="timeline-item">
        <div class="timeline-dot"></div>
        <div class="timeline-card">
          <time class="timeline-date">{{ .Date.Format "2006-01-02" }}</time>
          <h2 class="timeline-title">
            <a href="{{ .Permalink }}">{{ .Title }}</a>
          </h2>
          {{- if (ne (.Param "hideSummary") true) }}
          <p class="timeline-summary">{{ .Summary | plainify | htmlUnescape }}</p>
          {{- end }}
          {{- with .GetTerms "tags" }}
          <div class="timeline-tags">
            {{- range . }}
            <a href="{{ .Permalink }}" class="timeline-tag">{{ .LinkTitle }}</a>
            {{- end }}
          </div>
          {{- end }}
        </div>
      </article>
      {{- end }}
    </div>

    {{- if gt $paginator.TotalPages 1 }}
    <footer class="page-footer">
      <nav class="pagination">
        {{- if $paginator.HasPrev }}
        <a href="{{ $paginator.Prev.URL | absURL }}">&larr; {{ i18n "prev_page" }}</a>
        {{- else }}
        <span></span>
        {{- end }}
        {{- if $paginator.HasNext }}
        <a href="{{ $paginator.Next.URL | absURL }}">{{ i18n "next_page" }} &rarr;</a>
        {{- end }}
      </nav>
    </footer>
    {{- end }}
  </section>
</div>

<!-- Scripts -->
{{- if hugo.IsProduction }}
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
{{- end }}
<script>
fetch('https://v1.hitokoto.cn?c=a&c=b&c=d&c=i&c=k')
  .then(r => r.json())
  .then(d => {
    document.getElementById('hitokoto').innerText = 'ã€Œ' + d.hitokoto + 'ã€';
    document.getElementById('hitokoto-from').innerText = 'â€”â€” ' + (d.from_who || d.from || '');
  })
  .catch(() => {
    document.getElementById('hitokoto').innerText = 'ã€Œä»£ç æ˜¯å†™ç»™äººçœ‹çš„ï¼Œé¡ºä¾¿èƒ½åœ¨æœºå™¨ä¸Šè¿è¡Œã€‚ã€';
    document.getElementById('hitokoto-from').innerText = 'â€”â€” Harold Abelson';
  });
</script>
{{- end }}
