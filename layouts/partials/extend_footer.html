<div id="reading-progress"></div>
<button id="back-to-top" aria-label="Back to top" title="Back to Top">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
</button>
<script>
window.addEventListener('scroll', function() {
  var p = document.getElementById('reading-progress');
  if (!p) return;
  var h = document.body.scrollHeight - window.innerHeight;
  p.style.width = (h > 0 ? (window.scrollY / h) * 100 : 0) + '%';
});
</script>
<script>
(function() {
  var btn = document.getElementById('back-to-top');
  if (!btn) return;
  window.addEventListener('scroll', function() {
    btn.classList.toggle('visible', window.scrollY > 300);
  }, { passive: true });
  btn.addEventListener('click', function() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
})();
</script>
<script>
(function() {
  document.querySelectorAll('.highlight').forEach(function(highlight) {
    if (highlight.querySelector('.copy-btn')) return;
    var code = highlight.querySelector('code');
    if (!code) return;
    var btn = document.createElement('button');
    btn.className = 'copy-btn';
    btn.textContent = 'Copy';
    btn.addEventListener('click', function() {
      navigator.clipboard.writeText(code.textContent).then(function() {
        btn.textContent = 'Copied!';
        setTimeout(function() { btn.textContent = 'Copy'; }, 2000);
      });
    });
    highlight.appendChild(btn);
  });
})();
</script>
<script>
(function() {
  var toc = document.getElementById('toc-nav');
  if (!toc) return;
  var links = toc.querySelectorAll('a[href^="#"]');
  if (!links.length) return;
  var headings = [];
  links.forEach(function(a) {
    var id = a.getAttribute('href').slice(1);
    var el = document.getElementById(id);
    if (el) headings.push({ el: el, link: a });
  });
  function update() {
    var scrollY = window.scrollY + 100;
    var current = null;
    for (var i = 0; i < headings.length; i++) {
      if (headings[i].el.offsetTop <= scrollY) current = headings[i];
    }
    links.forEach(function(a) { a.classList.remove('active'); });
    if (current) current.link.classList.add('active');
  }
  window.addEventListener('scroll', update, { passive: true });
  update();
})();
</script>
